# Auto-detect NVCC compiler
NVCC := $(shell which nvcc 2>/dev/null || echo /usr/local/cuda/bin/nvcc)

# Check if nvcc exists
ifeq ($(shell test -x $(NVCC) && echo yes),yes)
    $(info Found NVCC at: $(NVCC))
else
    $(error NVCC not found. Please install CUDA toolkit)
endif
CXXFLAGS = -std=c++17

SRCS = src/main_gpu.cu \
       src/autoencoder.cu \
       src/utils/cuda_utils.cpp \
       src/utils/gpu_memory.cu \
       src/kernels/conv2d.cu \
       src/kernels/maxpool.cu \
       src/kernels/relu.cu \
       src/kernels/upsample.cu

INC = -I Include

run_gpu:
	$(NVCC) $(CXXFLAGS) $(SRCS) $(INC) -o run_gpu

clean:
	rm -f run_gpu

.PHONY: clean
