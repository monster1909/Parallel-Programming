# Makefile for Phase 2 Training

NVCC = nvcc
NVCC_FLAGS = -std=c++11 -arch=sm_75 -O3

# Directories
PHASE2_DIR = ../../phase2_gpu_basic
TRAIN_DIR = ..

# Include paths
INCLUDES = -I$(PHASE2_DIR)/Include -I$(TRAIN_DIR)/include

# Source files
SOURCES = train_phase2.cu \
          $(PHASE2_DIR)/src/kernels/conv2d.cu \
          $(PHASE2_DIR)/src/kernels/relu.cu \
          $(PHASE2_DIR)/src/kernels/maxpool.cu \
          $(PHASE2_DIR)/src/kernels/upsample.cu \
          $(TRAIN_DIR)/src/kernels/conv2d_backward.cu \
          $(TRAIN_DIR)/src/kernels/relu_backward.cu \
          $(TRAIN_DIR)/src/kernels/maxpool_backward.cu \
          $(TRAIN_DIR)/src/kernels/upsample_backward.cu \
          $(TRAIN_DIR)/src/kernels/mse_loss.cu \
          $(TRAIN_DIR)/src/sgd_optimizer.cu \
          $(TRAIN_DIR)/src/data_loader.cpp \
          $(TRAIN_DIR)/src/logger.cpp

# Output
TARGET = train_phase2

all: $(TARGET)

$(TARGET): $(SOURCES)
	@echo "Compiling Phase 2 Training..."
	$(NVCC) $(NVCC_FLAGS) $(INCLUDES) $(SOURCES) -o $(TARGET)
	@echo "Build complete: $(TARGET)"

clean:
	rm -f $(TARGET)
	rm -f logs/*.log
	@echo "Cleaned build files"

run: $(TARGET)
	./$(TARGET)

.PHONY: all clean run
